apply plugin: 'java'
apply plugin: 'war'

repositories {
    mavenCentral()
    }

def String versionNumber

task incVersion << {
    ext {
    versionFile = file('gradle.properties')
    }
    if(versionFile.canRead()) {
    versionFile.withReader { 
    reader -> versionNumber = reader.readLine()
    }
    def (major, minor, patch) = versionNumber.tokenize('.')
    println major + "." + minor + "." + patch
    def temp = patch.toInteger() + 1
    versionNumber = "${major}.${minor}.${temp}"
    println versionNumber
    new File("gradle.properties").write(versionNumber)
    new File("./build/resources/main/greeting.txt").write(versionNumber)
    } else {
    throw new GradleException( 'Can not read file.' )
    }
}

task copyVersion << {
    ext {
    versionFile = file('gradle.properties')
    }
    if(versionFile.canRead()) {
    versionFile.withReader { 
    reader -> versionNumber = reader.readLine()
    }
    def (major, minor, patch) = versionNumber.tokenize('.')
    println major + "." + minor + "." + patch
    def temp = patch.toInteger() + 1
    versionNumber = "${major}.${minor}.${temp}"
    println versionNumber
    new File("./build/resources/main/greeting.txt").write(versionNumber)
    } else {
    throw new GradleException( 'Can not read file.' )
    }
}

war.dependsOn incVersion
copyVersion.mustRunAfter processResources

dependencies {
    compile group: 'commons-collections', name: 'commons-collections', version: '3.2.2'
    compile group: 'org.apache.commons', name: 'commons-io', version: '1.3.2'
    compile group: 'log4j', name: 'log4j', version: '1.2.17'
    testCompile group: 'junit', name: 'junit', version: '4.+'
}
